#!/bin/bash

set -euo pipefail

CZBI_BIN="$HOME/.local/bin"
CZBI_HOME="${XDG_DATA_HOME:-"$HOME/.local/share"}/czbi"

case "$1" in
    home)       echo "$CZBI_HOME"
                exit 0
                ;;

    uninstall)  set -x
                rm "$CZBI_BIN/$2"
                exit 0
                ;;
esac

# Ok we're installing!

set -x

REPO="$1"

mkdir -p "$CZBI_HOME"
cd "$CZBI_HOME" || exit 1

if [[ -d $REPO ]]
then
    cd "$REPO" || exit 1
    git pull
else
    git clone "https://github.com/$REPO" "$REPO"
    cd "$REPO" || exit 1
fi

zig build

for exe in $(find zig-out/bin -type f)
do
    existing="$CZBI_BIN/$(basename "$exe")"
    if [[ -f $existing ]]
    then
        rm "$existing"
    fi

    ln -s "$PWD/$exe" "$CZBI_BIN/"
done

